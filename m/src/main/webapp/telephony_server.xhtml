<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html">
    <h:head>
        <title>Telephony</title>
        <link rel="stylesheet" href="http://192.168.13.41:2222/Content/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="http://192.168.13.41:2222/Content/css/toolbar.css"/>
        <script type="text/javascript" src="http://192.168.13.41:2222/Content/js/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="http://192.168.13.41:2222/Scripts/jquery.signalR-2.1.2.min.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="http://192.168.13.41:1111/signalr/hubs"></script>
        <!--Reference the autogenerated telephony script. -->
        <script type="text/javascript" src="http://192.168.13.41:2222/Content/js/telephony-lite.js"></script>   

        <script type="text/javascript">
            //function loginPhone(loginAspect, pwdAspect, stationNo, serviceId){
            var loginAspect = '#{userSession.users.telephonyLoginName}';
            var pwdAspect = '#{userSession.users.telephonyPassword}';
            var stationNo = '#{userSession.stationNo}';
            var serviceId = '#{userSession.userGroup.telephonyServiceId}';
            var af = parent.document.getElementById('actionframe');
            var mf = parent.document.getElementById('mainframe');
            var objAf = getIframeWindow(af);
            var objMf = getIframeWindow(mf);
            
            function getIframeWindow(iframe_object) {
                var doc;

                if (iframe_object.contentWindow) {
                    return iframe_object.contentWindow;
                }

                if (iframe_object.window) {
                    return iframe_object.window;
                }

                if (!doc) {
                    if (iframe_object.contentDocument) {
                        doc = iframe_object.contentDocument;
                    }
                }

                if (!doc) {
                    if (iframe_object.document) {
                        doc = iframe_object.document;
                    }
                }

                if (doc) {
                    if (doc.defaultView) {
                        return doc.defaultView;
                    }
                }

                if (doc) {
                    if (doc.parentWindow) {
                        return doc.parentWindow;
                    }
                }

                return undefined;
            }
            function loginPhone() {
                localStorage.setItem('userId', loginAspect);
                localStorage.setItem('pasw', pwdAspect);
                localStorage.setItem('station', stationNo);
                localStorage.setItem('signalrId', '');
                localStorage.setItem('serviceId', serviceId);
                //console.log('LOGIN : ' + loginAspect +','+ pwdAspect +','+ stationNo +','+ serviceId)
                //ApiLogin(loginAspect, pwdAspect, stationNo, serviceId);
            }
            function logoutPhone(param1, param2, reason) {
                ApiLogout(loginAspect, stationNo, reason);
            }
            function dialPhone(param1, param2, phoneNo) {
                ApiDial(loginAspect, stationNo, phoneNo);
            }
            function dialExt(ext) {
                ApiSendDTMF(loginAspect, stationNo, ext);
            }
            function getCurrentState() {
                var currentState = ApiGetCurrentState();
                //console.log("Current State : " + currentState);
                return currentState;
            }
            function telephonyStateChange(state) {
                var state = state.toUpperCase();
                var trackId = ApiGetTelephonyTrackId();
                var talkTime = ApiGetTalkTime();
                //alert(state);
                //console.log("Current State : " + state);
                //parent.document.getElementById('actionframe').contentWindow.setLineStatus(state);
                //parent.document.getElementById('mainframe').contentWindow.buttonDialChange(state);
                if (typeof objAf.setLineStatus === 'function') {
                    //console.log('setLineStatus = ' + state);
                    objAf.setLineStatus(state);
                }
                if (typeof objMf.buttonDialChange === 'function') {
                    console.log('JUI : state = ' + state);
                    console.log('JUI : trackId = ' + trackId);
                    console.log('JUI : talkTime = ' + talkTime);
                    objMf.buttonDialChange(state, trackId, talkTime);
                }
            }
            function hangupPhone() {
                ApiHangup(loginAspect, stationNo);
            }
            function agentNotReady() {
                ApiAgentNotReady(loginAspect, stationNo, '0');
            }
            function agentReady() {
                ApiAgentReady(loginAspect, stationNo);
            }
            function saveDisposition(code, param1, param2, param3, param4, param5, param6, param7, param8, param9, param10, param11, param12, param13, param14, param15, param16, param17, param18, param19, param20) {
                ApiNextCall(loginAspect, stationNo, code, param1, param2, param3, param4, param5, param6, param7, param8, param9, param10, param11, param12, param13, param14, param15, param16, param17, param18, param19, param20);
            }
            function getTelephonyTrackId() {
                var trackId = ApiGetTelephonyTrackId();
                return trackId;
            }
            function getTalkTime() {
                var talkTime = ApiGetTalkTime();
                //console.log("getTalkTime = " + talkTime);
                return talkTime;

            }
            function setTalkTime(telephonyTrackId, talkTime) {
                if (typeof objAf.setTalkTime === 'function') {
                    //objAf.setTalkTime(telephonyTrackId, talkTime);
                    console.log('Track ID : ' + telephonyTrackId);
                    console.log('Talk Time : ' + talkTime);
                }
            }
            function onStartAutoRecordingChange(RecordingType, PhoneNo, CallCategory, TrackID) {
                console.log('##### : onStartAutoRecordingChange : #' + RecordingType + "#");
                console.log('##### : PhoneNo : ' + PhoneNo);
                console.log('##### : CallCategory : ' + CallCategory);
                console.log('##### : TrackID : ' + TrackID);
                //var currentState = ApiGetCurrentState();
                var recordingTypeStr = "";
                var callCategoryStr = "";
                if (RecordingType === 1) {
                    recordingTypeStr = "A";
                } else if (RecordingType === 0) {
                    recordingTypeStr = "M";
                } else {
                    recordingTypeStr = "A";
                }

                if (CallCategory === 1) {
                    callCategoryStr = "inbound";
                } else if (CallCategory === 2) {
                    callCategoryStr = "outbound";
                } else {
                    callCategoryStr = "outbound";
                }
                //console.log('recordingTypeStr = ' + recordingTypeStr);
                if (recordingTypeStr === 'A') {
                    //console.log('onStartAutoRecordingChange 1 = ' + currentState);
                    if (typeof getIframeWindow(af).createContactHistory === 'function') {
                        //getIframeWindow(af).createContactHistory(PhoneNo, callCategoryStr, TrackID, '');
                    }
                }
            }
        </script>
    </h:head>
    <h:body>
        <table style="width:100%; background-color:#4f4f4f;height:22px;border: 0px">
            <tr>
                <td width="25"><img src="http://192.168.13.41:2222/Content/logo/white-phone-32.png" alt="" /></td>
                <td style="font-weight:bold;font-family:Tahoma;font-size:14px;width:110px;color:Window ">Telephony v1.1</td>
                <td>&nbsp;</td>
                <td style="width:200px">
                    <table style="height:30px">
                        <tr>
                            <td class="label-left-info" style="display:none"><label>User :</label></td>
                            <td class="label-left-info" style="display:none"><label id="lblUserId">Human</label>&nbsp;</td>
                            <td class="label-left-info"><label>Station :</label></td>
                            <td class="label-left-info"><label id="lblStation">0000</label></td>
                        </tr>
                    </table>
                </td>
                <td align="right">
                    <table>
                        <tr>
                            <td>
                                <button type="button" id="btnHold" class="btn btn-default btn-sm">Hold</button>
                                <button type="button" id="btnUnHold" class="btn btn-default btn-sm">UnHold</button>
                            </td>
                            <td width="50"></td>
                        </tr>
                    </table>
                </td>
                <td width="360" align="center">
                    <div style="background-color:rgba(128, 128, 128, 0.57);border-radius:3px;height:24px">
                        <table style="width:100%">
                            <tr>
                                <td style="width:20%"><div id="panelStateColor" style="font-size:16px;font-family:Tahoma;background-color:orange;font-weight:bold;width:100%;height:100%">&nbsp;</div></td>
                                <td align="center" style="width:220px"><div style="font-size:16px;font-family:Tahoma;color:orange;font-weight:bold" id="panelState">Phone State</div></td>
                                <td>
                                    <img src="http://192.168.13.41:2222/Content/logo/time-32.png" alt="" />
                                </td>
                                <td>
                                    <div style="font-size:16px;font-family:Tahoma;color:orange;font-weight:bold" id="panelClock">
                                        <span id="minutes">00</span>:<span id="seconds">00</span>
                                    </div>
                                </td>
                                <td style="width:15px;">&nbsp;</td>
                            </tr>
                        </table>
                    </div>
                </td>
                <td style="width:15px;" align="center"></td>
                <td align="right" style="font-weight:bold;font-family:Tahoma;font-size:12px" width="80">  Powered by</td>
                <td width="20" align="right">
                    <img src="http://192.168.13.41:2222/Content/logo/maxelyz.png" alt=""/>
                </td>
            </tr>
        </table>
        <script type="text/javascript">loginPhone()</script>
    </h:body>
</html>
